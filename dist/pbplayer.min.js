/*!
 * pbPlayer v4.0.0
 * https://github.com/Pluxbox/pbPlayer
 *
 * Requires pbjs javascript framework (>= 0.6.0)
 * https://github.com/Saartje87/pbjs-0.6
 *
 * Copyright 2013 Pluxbox
 * Licensed MIT
 *
 * Build date 2013-07-11 14:14
 */
!function(a,b,c){this[a]=c(b)}("pbPlayer",this,function(a){"use strict";function b(a){e.push(a)}function c(a){e.unpush(a)}var d,e=[],f=a.PB;if(a.pbPlayer,!f)throw new Error("Missing dependency pbjs");d=f.Class(f.Observer,{construct:function(a,c){return this instanceof d?(this.parent(),c||(c=a,a=null),this.options=f.overwrite({},d.defaults),f.overwrite(this.options,c),this.playlist=new h(this),this.mediaContainer=null,this.skin=null,b(this),this._playerData={volume:this.options.volume},void 0):new d(a,c)},destroy:function(){this.mediaContainer&&(this.mediaContainer.destroy(),this.mediaContainer=null),this.skin&&(this.skin.destroy(),this.skin=null),c(this)},addMedia:function(a){this.playlist.add(a),this.options.autostart&&1===this.playlist.size()&&this.play()},removeMedia:function(a){this.playlist.remove(a)},emptyMedia:function(){this.playlist.empty()},getMediaContainer:function(a){var b,c,e=this.options.solution.replace(",","").split(" "),g=0;if(!this.mediaContainer){for(;g<e.length;g++)b=e[g],c=d.mediaContainers[b],c?f.each(a,function(b,d){return c.canPlayType(b)?(this.mediaContainer=new c(this,d,a),!0):void 0},this):this.emit("error",{message:"Media container `"+b+"` not found"});this.mediaContainer||this.emit("error",{message:"No suitable media container found",media:a})}},emit:function(a,b){var c={type:a,target:this};f.overwrite(c,b),f.log("Event triggered: ",a,c),this.parent(a,c)},getVolume:function(){return this._playerData.volume},getDuration:function(){},getPosition:function(){},isBuffering:function(){},isPlaying:function(){},isPaused:function(){},isStopped:function(){}});var g="play pause stop playAt setVolume mute unmute".split(" ");g.length,f.each(g,function(a,b){d.prototype[b]=function(){var a=this.playlist.getCurrent();return a?(this.getMediaContainer(a),this.mediaContainer?(this.mediaContainer[b].apply(this.mediaContainer,f.toArray(arguments)),void 0):this):this.emit("error",{message:"No media given"})}}),d.defaults={solution:"html5 flash",autostart:!1,volume:100,path:"/pbPlayer/dist/",preload:"auto"},d.mediaContainers={},d.registerMediaContainer=function(a,b){d.mediaContainers[a]=b},d.config=function(a){f.overwrite(d.defaults,a)};var h=f.Class({construct:function(a){this._player=a,this._entries=[],this._currentEntryIndex=0},add:function(a){var b=0;if(a instanceof Array)for(;b<a.length;b++)this.add(a[b]);else!a instanceof Object||this.has(a)||(this._entries.push(a),this._player.emit("mediaadded",{media:a}))},has:function(a){return-1!==this._entries.indexOf(a)},size:function(){return this._entries.length},remove:function(a){var b=0;if(a instanceof Array)for(;b<a.length;b++)this.remove(a[b]);else{var c=this._entries.indexOf(a);-1!==c&&this._player.emit("mediaremoved",{media:this._entries.splice(c,1)[0]})}},empty:function(){for(;this._entries.length;)this.remove(this._entries[0])},getCurrent:function(){var a=this._entries[this._currentEntryIndex];return a?a:null},next:function(){var a=this._entries[this._currentEntryIndex+1];void 0!==a&&(this._currentEntryIndex++,this._player.emit("mediachanged",{media:a}))},previous:function(){var a=this._entries[this._currentEntryIndex-1];void 0!==a&&(this._currentEntryIndex--,this._player.emit("mediachanged",{media:a}))}}),i=f.Class({NETWORK_ERROR:"NETWORK_EMPTY NETWORK_IDLE NETWORK_LOADED NETWORK_LOADING NETWORK_NO_SOURCE".split(" "),construct:function(a,b){"metadata"===a.options.preload?"metadata":"auto",this._src=b,this._play=this.play.bind(this),this.pbPlayer=a,this.loading=!1,this.element=f.$('<audio preload="'+a.options.preload+'" />'),this.addEvents(),this.element=this.element.appendTo(document.body)[0],this.element.src=b,this.progress()},destroy:function(){this.element.pause(),this.element.src="",f.$(this.element).remove(),this.element=null,this.pbPlayer=null},addEvents:function(){this._progress=this.progress.bind(this),this.element.on("loadedmetadata",this.metadataLoaded.bind(this)).on("error pause play volumechange ended timeupdate",this.eventDelegation.bind(this))},metadataLoaded:function(){this.pbPlayer.emit("duration",{length:this.element.duration})},progress:function(){var a=this.element,b=a?a.error:null,c=a?a.buffered:null;if(a){if(null!==b)return this.pbPlayer.emit("error",{code:this.element.error,message:this.NETWORK_ERROR[this.element.error]}),void 0;if(c.length&&this.pbPlayer.emit("progress",{loaded:Math.floor(100*(c.end(0)/a.duration))}),a.readyState>=3)return this.pbPlayer.emit("progress",{loaded:100}),this.pbPlayer.emit("loaded"),void 0;window.setTimeout(this._progress,100),a=null}},eventDelegation:function(a){var b={};switch(a.type){case"timeupdate":b.position=this.element.currentTime,b.progress=this.element.currentTime*(100/this.element.duration)||0;break;case"volumechange":b.volume=this.element.muted?0:parseInt(100*this.element.volume,10)}this.pbPlayer.emit(a.type,b)},set:function(a){return this.stop(),this.element.src=a,this.progress(),this},play:function(){this.element.src!==this._src&&(this.element.src=this._src);try{this.element.currentTime=this.element.currentTime,this.element.play()}catch(a){this.loading||(this.element.load(),this.loading=!0),setTimeout(this._play,17)}},pause:function(){this.element.pause()},stop:function(){this.element.pause();try{this.element.currentTime=0}catch(a){}this.element.src="",this.loading=!1,this.pbPlayer.emit("stop")},setVolume:function(a){this.element.volume=a/100},mute:function(){this.element.muted=!0},unmute:function(){this.element.muted=!1},playAt:function(a){this.element.currentTime=a}});return i.codecs={mp3:'audio/mpeg; codecs="mp3"',ogg:'audio/ogg; codecs="vorbis, opus"',opus:'audio/ogg; codecs="opus"',wav:'audio/wav; codecs="1"',aac:'audio/aac; codecs="aac"'},i.canPlayType=function(a){var b,c;if(!window.Audio||!i.codecs[a])return!1;b=new window.Audio,c=b.canPlayType(i.codecs[a]);try{if(navigator.userAgent.indexOf("Safari")>-1&&-1===navigator.userAgent.indexOf("Mobile")&&f.browser.version<=5)return!1}catch(d){}return"probably"===c||"maybe"===c},d.registerMediaContainer("html5",i),d});