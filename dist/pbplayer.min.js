/*!
 * pbPlayer v4.0.0
 * https://github.com/Pluxbox/pbPlayer
 *
 * Requires pbjs javascript framework (>= 0.6.0)
 * https://github.com/Saartje87/pbjs-0.6
 *
 * Copyright 2013 Pluxbox
 * Licensed MIT
 *
 * Build date 2013-07-12 11:07
 */
!function(a,b,c){this[a]=c(b)}("pbPlayer",this,function(a){"use strict";function b(a){e.push(a)}function c(a){e.unpush(a)}var d,e=[],f=a.PB;if(a.pbPlayer,!f)throw new Error("Missing dependency pbjs");d=f.Class(f.Observer,{construct:function(a,c){return this instanceof d?(this.parent(),c||(c=a,a=null),this.options=f.overwrite({},d.defaults),f.overwrite(this.options,c),this.playlist=new h(this),this.mediaContainer=null,this.skin=null,b(this),this._playerData={volume:this.options.volume,time:0,duration:0},void 0):new d(a,c)},destroy:function(){this.mediaContainer&&(this.mediaContainer.destroy(),this.mediaContainer=null),this.skin&&(this.skin.destroy(),this.skin=null),c(this)},addMedia:function(a){this.playlist.add(a),this.options.autostart&&1===this.playlist.size()&&this.play()},removeMedia:function(a){this.playlist.remove(a)},emptyMedia:function(){this.playlist.empty()},getMediaContainer:function(){var a,b,c,e=this.options.solution.replace(",","").split(" "),g=0;if(this.mediaContainer)return!0;if(a=this.playlist.getCurrent(),!a)return this.emit("error",{message:"No media given"}),!1;for(;g<e.length;g++)if(b=e[g],c=d.mediaContainers[b]){if(f.each(a,function(b,d){return c.canPlayType(b)?(this.mediaContainer=new c(this,d,a),!0):void 0},this),this.mediaContainer)break}else this.emit("error",{message:"Media container `"+b+"` not found"});return this.mediaContainer||this.emit("error",{message:"No suitable media container found",media:a}),!!this.mediaContainer},emit:function(a,b){var c={type:a,target:this};switch(f.overwrite(c,b),this.options.debug&&f.log("Event triggered: ",a,c),a){case"volume":this._playerData.volume=b.volume;break;case"timeupdate":this._playerData.time=b.position;break;case"duration":this._playerData.duration=b.length;break;case"play":this._playerData.playState=d.PLAYSTATE_PLAYING;break;case"pause":this._playerData.playState=d.PLAYSTATE_PAUSED;break;case"stop":this._playerData.playState=d.PLAYSTATE_STOPPED}this.parent(a,c)},setVolume:function(a){return this.getMediaContainer()?(a=parseInt(a,10),a=0>a?0:a>100?100:a,this.mediaContainer.setVolume(value),void 0):this},getVolume:function(){return this._playerData.volume},getDuration:function(){return this._playerData.duration},getTime:function(){return this._playerData.time},isPlaying:function(){return this._playerData.playState===d.PLAYSTATE_PLAYING},isPaused:function(){return this._playerData.playState===d.PLAYSTATE_PAUSED},isStopped:function(){return this._playerData.playState===d.PLAYSTATE_STOPPED}});var g="play pause stop playAt setVolume mute unmute".split(" ");g.length,f.each(g,function(a,b){d.prototype[b]=function(){return this.getMediaContainer()?(this.mediaContainer[b].apply(this.mediaContainer,f.toArray(arguments)),void 0):this}}),d.defaults={debug:!0,solution:"html5 flash",autostart:!1,volume:100,path:"/pbPlayer/dist/",preload:"auto"},d.PLAYSTATE_PLAYING=1,d.PLAYSTATE_PAUSED=2,d.PLAYSTATE_STOPPED=3,d.mediaContainers={},d.registerMediaContainer=function(a,b){d.mediaContainers[a]=b},d.config=function(a){f.overwrite(d.defaults,a)};var h=f.Class({construct:function(a){this._player=a,this._entries=[],this._currentEntryIndex=0},add:function(a){var b=0;if(a instanceof Array)for(;b<a.length;b++)this.add(a[b]);else!a instanceof Object||this.has(a)||(this._entries.push(a),this._player.emit("mediaadded",{media:a}))},has:function(a){return-1!==this._entries.indexOf(a)},size:function(){return this._entries.length},remove:function(a){var b=0;if(a instanceof Array)for(;b<a.length;b++)this.remove(a[b]);else{var c=this._entries.indexOf(a);-1!==c&&this._player.emit("mediaremoved",{media:this._entries.splice(c,1)[0]})}},empty:function(){for(;this._entries.length;)this.remove(this._entries[0])},getCurrent:function(){var a=this._entries[this._currentEntryIndex];return a?a:null},next:function(){var a=this._entries[this._currentEntryIndex+1];void 0!==a&&(this._currentEntryIndex++,this._player.emit("mediachanged",{media:a}))},previous:function(){var a=this._entries[this._currentEntryIndex-1];void 0!==a&&(this._currentEntryIndex--,this._player.emit("mediachanged",{media:a}))}}),i=f.Class({NETWORK_ERROR:"NETWORK_EMPTY NETWORK_IDLE NETWORK_LOADED NETWORK_LOADING NETWORK_NO_SOURCE".split(" "),construct:function(a,b){"metadata"===a.options.preload?"metadata":"auto",this._src=b,this._play=this.play.bind(this),this.pbPlayer=a,this.loading=!1,this.element=f.$('<audio preload="'+a.options.preload+'" />'),this.addEvents(),this.element=this.element.appendTo(document.body)[0],this.element.src=b,this.setVolume(a._playerData.volume),this.progress()},destroy:function(){this.element.pause(),this.element.src="",f.$(this.element).remove(),this.element=null,this.pbPlayer=null},addEvents:function(){this._progress=this.progress.bind(this),this.element.on("loadedmetadata",this.metadataLoaded,this).on("error pause play volumechange ended timeupdate",this.eventDelegation,this)},metadataLoaded:function(){this.pbPlayer.emit("duration",{length:this.element.duration})},progress:function(){var a=this.element,b=a?a.error:null,c=a?a.buffered:null;if(a&&(!b||!b.code))return c.length&&this.pbPlayer.emit("progress",{loaded:Math.floor(100*(c.end(0)/a.duration))}),a.readyState>=3?(this.pbPlayer.emit("progress",{loaded:100}),this.pbPlayer.emit("loaded"),void 0):(window.setTimeout(this._progress,100),void 0)},eventDelegation:function(a){var b={};switch(a.type){case"timeupdate":b.position=this.element.currentTime,b.progress=this.element.currentTime*(100/this.element.duration)||0;break;case"volumechange":b.volume=this.element.muted?0:parseInt(100*this.element.volume,10);break;case"error":b.code=this.element.error.code,b.message=this.NETWORK_ERROR[this.element.error.code]}this.pbPlayer.emit(a.type,b)},set:function(a){return this.stop(),this.element.src=a,this.progress(),this},play:function(){this.element.src.indexOf(this._src)<0&&(this.element.src=this._src);try{this.element.currentTime=this.element.currentTime,this.element.play()}catch(a){this.loading||(this.element.load(),this.loading=!0),setTimeout(this._play,17)}},pause:function(){this.element.pause()},stop:function(){this.element.pause();try{this.element.currentTime=0}catch(a){}this.element.src="",this.loading=!1,this.pbPlayer.emit("stop"),this.pbPlayer.emit("timeupdate",{position:0,progress:0})},setVolume:function(a){this.element.volume=a/100},mute:function(){this.element.muted=!0},unmute:function(){this.element.muted=!1},playAt:function(a){try{this.element.currentTime=a}catch(b){setTimeout(this.playAt.bind(this,a),50)}}});i.codecs={mp3:'audio/mpeg; codecs="mp3"',ogg:'audio/ogg; codecs="vorbis, opus"',opus:'audio/ogg; codecs="opus"',wav:'audio/wav; codecs="1"',aac:'audio/aac; codecs="aac"'},i.canPlayType=function(a){var b,c;if(!window.Audio||!i.codecs[a])return!1;b=new window.Audio,c=b.canPlayType(i.codecs[a]);try{if(navigator.userAgent.indexOf("Safari")>-1&&-1===navigator.userAgent.indexOf("Mobile")&&f.browser.version<=5)return!1}catch(d){}return"probably"===c||"maybe"===c},d.registerMediaContainer("html5",i);var j;if(window.__pbPlayer_flash__={},navigator.plugins&&navigator.plugins["Shockwave Flash"])j=navigator.plugins["Shockwave Flash"].description;else if(window.ActiveXObject)try{j=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(k){}j&&(j=j.match(/\d+/g),j=Number(j[0]+"."+j[1]));var l=f.Class({construct:function(a,b){var c=a.options.path;this.pbPlayer=a,this.id="pbplayer-"+f.id(),this.maxTries=25,this.queue=[],this.flashReady=!1,c+=a.playlist.getCurrent().stream?"pbstreamplayer.swf":"pbplayer.swf",this.element=document.addEventListener?f.$('<embed width="0" height="0" id="'+this.id+'" '+'src="'+c+"?ac="+Date.now()+'"'+'allowscriptaccess="always" type="application/x-shockwave-flash"'+'pluginspage="http://www.macromedia.com/go/getflashplayer"></embed>'):f.$('<object id="'+this.id+'" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=8,0,40,0" width="0" height="0">'+'<param name="movie" value="'+c+"?ac="+Date.now()+'">'+'<param name="quality" value="high">'+'<param name="bgcolor" value="#FFFFFF">'+'<param name="allowScriptAccess" value="always">'+"</object>"),window.__pbPlayer_flash__[this.id]=this.eventDelegation.bind(this),this.element=this.element.appendTo(document.body)[0],this._isLoaded=this.isLoaded.bind(this),this.isLoaded(),this.set(b),this.setVolume(a._playerData.volume)},eventDelegation:function(a,b){this.pbPlayer.emit(a,b)},isLoaded:function(){return this.element._playerId?(this.element._playerId(this.id),this.flashReady=!0,this.queue.forEach(function(a){null===a.args?this[a.method].call(this):this[a.method].call(this,f.toArray(a.args))},this),void 0):--this.maxTries?(setTimeout(this._isLoaded,50),void 0):(this.pbPlayer.emit("error",{message:"Flash file not found in `"+this.pbPlayer.options.path+"`",code:404}),void 0)},destroy:function(){clearTimeout(this.isLoadedTimer);try{this.element._close&&this.element._close()}catch(a){}f.$(this.element).remove(),this.element=null,this.pbPlayer=null;try{delete window.__pbPlayer_flash__[this.id]}catch(a){window.__pbPlayer_flash__[this.id]=null}},addToQueue:function(a,b){this.queue.push({method:a,args:b||null})},set:function(a){return this.flashReady?(this.element._src(a),void 0):(this.addToQueue("set",arguments),void 0)},play:function(){return this.flashReady?(this.element._play(),void 0):(this.addToQueue("play"),void 0)},pause:function(){this.element._pause&&this.element._pause()},stop:function(){return this.flashReady?(this.element._stop(),void 0):(this.addToQueue("stop"),void 0)},setVolume:function(a){return this.flashReady?(this.currentVolume=a,this.element._volume(a),void 0):(this.addToQueue("setVolume",arguments),void 0)},mute:function(){return this.flashReady?(this.element._volume(0),void 0):(this.addToQueue("mute"),void 0)},unmute:function(){return this.flashReady?(this.element._volume(this.currentVolume),void 0):(this.addToQueue("unmute"),void 0)},playAt:function(a){return this.flashReady?(this.element._playAt(a),void 0):(this.addToQueue("playAt",arguments),void 0)}});return l.canPlayType=function(a){var b={mp3:!0,mp4:!0};return j>=9&&b[a]},d.registerMediaContainer("flash",l),d});